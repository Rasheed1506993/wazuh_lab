<div dir="rtl">
  <h2 style="text-align: center;">Wazuh Indexer</h2>

---

## مقدمة عن Wazuh Indexer

يُعد Wazuh Indexer أحد المكونات الأساسية في منظومة Wazuh للأمن السيبراني، حيث يمثل محرك البحث والتحليل في الوقت الفعلي للبيانات الأمنية. يقوم هذا المكون باستقبال البيانات الأمنية التي تم تحليلها من خلال خادم Wazuh، ومن ثم فهرستها وتخزينها بطريقة منظمة تسمح بالاستعلام السريع والفعال عنها من خلال لوحة التحكم Wazuh Dashboard.

يعتمد Wazuh Indexer على تقنيات OpenSearch في جوهره، مما يوفر قدرات بحث نصية كاملة وتحليلات متقدمة للبيانات الأمنية الضخمة. تُخزن البيانات على شكل مستندات بصيغة JSON، حيث يحتوي كل مستند على مجموعة من المفاتيح والقيم التي تمثل الأحداث الأمنية بكافة تفاصيلها.

## الهيكلية المعمارية لـ Wazuh Indexer

تتميز بنية Wazuh Indexer بالمرونة والقابلية للتوسع، حيث يمكن نشره في تكوينات مختلفة حسب متطلبات البيئة. يدعم النظام التكوين كعقدة واحدة للبيئات الصغيرة، أو كمجموعة عقد متعددة للبيئات الإنتاجية الكبيرة التي تتطلب توافرية عالية وقدرات معالجة متقدمة.

### مفهوم الشاردز والنسخ المتماثلة

يعتمد Wazuh Indexer على آلية توزيع البيانات باستخدام ما يُسمى بالشاردز (Shards)، وهي وحدات تخزين مستقلة يتم توزيعها عبر عقد المجموعة. كل شارد يمثل فهرساً فرعياً قابلاً للعمل بشكل مستقل، مما يحقق التوازي في العمليات ويزيد من الأداء الإجمالي للنظام.

بالإضافة إلى الشاردز الأساسية، يدعم النظام إنشاء نسخ متماثلة (Replicas) من كل شارد، مما يضمن استمرارية العمل في حالة فشل أي عقدة في المجموعة. تُوزع هذه النسخ المتماثلة على عقد مختلفة لضمان عدم فقدان البيانات وتحقيق التوافرية العالية.

![1](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/wazuh_indexer_cluster.svg)


## آلية العمل الداخلية للـ Indexer

تبدأ عملية الفهرسة عندما يرسل خادم Wazuh البيانات المُحللة إلى Wazuh Indexer عبر Filebeat. يقوم Filebeat بقراءة ملف التنبيهات المخزن في المسار `/var/ossec/logs/alerts/alerts.json` على خادم Wazuh، ثم يقوم بإرسال هذه التنبيهات على شكل مستندات JSON إلى واجهة برمجة التطبيقات الخاصة بـ Wazuh Indexer.

عند استقبال البيانات، يقوم Wazuh Indexer بتطبيق سلسلة من عمليات المعالجة المُسبقة على المستندات. تشمل هذه العمليات تحليل البيانات الجغرافية لعناوين IP، وتحويل الطوابع الزمنية إلى التنسيق الموحد، وإزالة الحقول غير الضرورية. يتم تنفيذ هذه العمليات من خلال خطوط معالجة مُعرفة مسبقاً في ملف `pipeline.json`.

بعد المعالجة، يتم توزيع المستندات على الشاردز المناسبة بناءً على خوارزمية التجزئة. يحدد النظام الشارد المستهدف عن طريق تطبيق دالة تجزئة على معرف المستند، مما يضمن توزيعاً متوازناً للبيانات عبر جميع الشاردز المتاحة. ثم يتم تخزين المستند في الشارد الأساسي ونسخه إلى جميع الشاردز المتماثلة المرتبطة به.

### عملية الاستعلام والبحث

عندما يرسل المستخدم استعلاماً عبر لوحة التحكم Wazuh Dashboard، يتم توجيه الطلب إلى Wazuh Indexer الذي يقوم بتنسيق عملية البحث عبر جميع الشاردز ذات الصلة. تعمل كل شارد على معالجة جزء من الاستعلام بشكل مستقل وموازٍ، مما يسرع من عملية البحث بشكل كبير.

يجمع النظام النتائج من جميع الشاردز، ثم يقوم بدمجها وترتيبها وفقاً لمعايير الاستعلام المحددة. تُستخدم تقنيات التخزين المؤقت الذكية لتحسين أداء الاستعلامات المتكررة، مما يقلل من زمن الاستجابة ويوفر موارد النظام.

![2](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/wazuh_data_flow.svg)

## البروتوكولات والتقنيات المستخدمة

يعتمد Wazuh Indexer على مجموعة من البروتوكولات والتقنيات المعيارية التي تضمن أماناً عالياً وأداءً موثوقاً في بيئات الإنتاج المختلفة.

### بروتوكول HTTPS والتشفير

يستخدم Wazuh Indexer بروتوكول HTTPS على المنفذ 9200 بشكل افتراضي لجميع عمليات الاتصال. يتطلب النظام تفعيل شهادات TLS صالحة لضمان تشفير البيانات أثناء النقل بين مختلف مكونات النظام. تُستخدم شهادات X.509 للمصادقة المتبادلة بين العملاء والخادم، مما يمنع هجمات الوسيط ويضمن سلامة البيانات.

يدعم النظام إصدار TLS 1.2 كحد أدنى، مع إمكانية التكوين لاستخدام الإصدارات الأحدث. يتم تخزين شهادات الأمان في المسار `/etc/wazuh-indexer/certs/` وتُدار من خلال ملف التكوين الرئيسي `opensearch.yml`.

### واجهة برمجية REST API

يوفر Wazuh Indexer واجهة برمجية شاملة تعتمد على بروتوكول REST، مما يتيح التفاعل مع جميع وظائف النظام من خلال طلبات HTTP القياسية. تدعم الواجهة البرمجية عمليات متعددة تشمل إنشاء وحذف الفهارس، والبحث في البيانات، وإدارة إعدادات المجموعة، ومراقبة حالة النظام.

يستخدم النظام آلية مصادقة قوية تعتمد على أسماء المستخدمين وكلمات المرور المشفرة، مع دعم كامل لإدارة الأدوار والصلاحيات. يمكن الوصول إلى الواجهة البرمجية من خلال أدوات مختلفة مثل cURL أو من خلال أداة Dev Tools المدمجة في لوحة التحكم Wazuh Dashboard.

### آلية الفهرسة باستخدام JSON

تعتمد بنية تخزين البيانات في Wazuh Indexer على تنسيق JSON بشكل أساسي. يتم تمثيل كل حدث أمني كمستند JSON منفصل يحتوي على مجموعة من الحقول المُهيكلة. تشمل هذه الحقول معلومات مثل الطابع الزمني، ومعرف الوكيل، ومستوى خطورة التنبيه، ومعلومات القاعدة المُطابقة، والبيانات الخاصة بالحدث نفسه.

يستخدم النظام مخططات محددة مسبقاً تُعرف بالقوالب Templates لضمان اتساق بنية البيانات عبر جميع الفهارس. يتم تطبيق هذه القوالب تلقائياً عند إنشاء فهارس جديدة، مما يضمن أن جميع الحقول تُفهرس بالطريقة الصحيحة وأن أنواع البيانات متطابقة مع التوقعات.

### خطوط معالجة البيانات Ingest Pipelines

يوفر Wazuh Indexer آلية قوية لمعالجة البيانات قبل فهرستها من خلال ما يُسمى بخطوط المعالجة Ingest Pipelines. تُعرف هذه الخطوط في ملفات JSON وتحتوي على سلسلة من المعالجات Processors التي تُطبق تحويلات مختلفة على البيانات الواردة.

تشمل المعالجات المُستخدمة تحويل البيانات الجغرافية من عناوين IP باستخدام قواعد بيانات GeoIP، وتحويل الطوابع الزمنية إلى التنسيق الموحد ISO8601، وإنشاء أسماء الفهارس الديناميكية بناءً على التاريخ، وإزالة الحقول غير المطلوبة لتقليل حجم التخزين. يتم تكوين هذه الخطوط في ملف `pipeline.json` الموجود في المسار `/usr/share/filebeat/module/wazuh/alerts/ingest/`.

### آلية التوزيع والتماثل

يستخدم Wazuh Indexer خوارزمية تجزئة متسقة Consistent Hashing لتوزيع المستندات عبر الشاردز المختلفة. عند إضافة مستند جديد، يتم حساب قيمة التجزئة من معرف المستند، ثم يُحدد الشارد المستهدف بناءً على هذه القيمة. تضمن هذه الآلية توزيعاً متوازناً للبيانات حتى عند إضافة أو إزالة شاردز من النظام.

يُدار التماثل من خلال آلية مزامنة قوية تضمن أن جميع النسخ المتماثلة لشارد معين تحتوي على نفس البيانات بالضبط. عند كتابة مستند جديد، يتم أولاً كتابته إلى الشارد الأساسي، ثم يُنسخ بشكل متزامن إلى جميع الشاردز المتماثلة قبل إرجاع تأكيد النجاح إلى العميل. تضمن هذه الآلية الاتساق القوي للبيانات عبر جميع نسخها.

![3](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/indexer_protocols.svg)

## أنماط الفهارس Index Patterns في Wazuh Indexer

يعتمد Wazuh Indexer على مجموعة من أنماط الفهارس المُحددة مسبقاً لتنظيم وتخزين أنواع مختلفة من البيانات الأمنية. كل نمط من هذه الأنماط يخدم غرضاً محدداً في منظومة المراقبة الأمنية ويحتوي على بنية بيانات متخصصة تناسب نوع المعلومات المُخزنة.

### فهرس التنبيهات wazuh-alerts-*

يُعتبر هذا النمط الأكثر أهمية في النظام حيث يخزن جميع التنبيهات الأمنية التي تُنشأ عندما تتطابق الأحداث مع قواعد الكشف المُحددة. يقوم خادم Wazuh بتحليل الأحداث الواردة من الوكلاء وعند اكتشاف نشاط مشبوه يطابق قاعدة معينة يتم إنشاء تنبيه وحفظه أولاً في ملف alerts.json ثم إرساله إلى Wazuh Indexer للفهرسة.

يتم إنشاء فهرس جديد لكل يوم بشكل افتراضي مثل wazuh-alerts-4.x-2023.03.17 لليوم السابع عشر من مارس. هذا التقسيم الزمني يسهل إدارة البيانات ويحسن أداء الاستعلامات حيث يمكن تحديد الفهارس المطلوب البحث فيها بناءً على النطاق الزمني المطلوب.

### فهرس الأرشيف wazuh-archives-*

بينما يخزن فهرس التنبيهات الأحداث التي أنشأت تنبيهات فقط فإن فهرس الأرشيف يمكن تفعيله لتخزين جميع الأحداث التي يستقبلها خادم Wazuh بغض النظر عن إنشاء تنبيهات أم لا. يفيد هذا الفهرس في التحليلات اللاحقة ومتطلبات الامتثال التنظيمي حيث قد يتطلب الأمر الاحتفاظ بسجل كامل لجميع الأحداث.

يجب الانتباه إلى أن تفعيل هذا الفهرس سيزيد بشكل كبير من متطلبات التخزين لذلك يُنصح بتقييم الحاجة الفعلية له قبل التفعيل. يتطلب التفعيل تعديل إعدادات في ملف ossec.conf على خادم Wazuh وملف filebeat.yml على خادم Filebeat.

### فهرس المراقبة wazuh-monitoring-*

يخزن هذا الفهرس سجلاً تاريخياً لحالات اتصال جميع وكلاء Wazuh المسجلين في النظام. تشمل الحالات الممكنة نشط أو غير متصل أو معلق أو لم يتصل مطلقاً. يتم تسجيل حالة كل وكيل كل خمسة عشر دقيقة بشكل افتراضي مما يوفر رؤية واضحة لتطور حالات الاتصال عبر الزمن.

تستخدم لوحة التحكم Wazuh Dashboard هذه البيانات لعرض معلومات مهمة مثل عدد الوكلاء النشطين والتطور التاريخي لحالاتهم ضمن أطر زمنية محددة. يتم إنشاء فهرس جديد أسبوعياً بشكل افتراضي لهذا النوع من البيانات.

### فهرس الإحصائيات wazuh-statistics-*

يحتوي هذا الفهرس على معلومات الأداء والاستخدام لخادم Wazuh بما في ذلك عدد الأحداث المُفككة والبايتات المُستقبلة وجلسات TCP النشطة. تستعلم لوحة التحكم من واجهة برمجية Wazuh Manager API لجمع هذه المعلومات وتخزينها في فهرس الإحصائيات.

يتم تخزين الإحصائيات كل خمس دقائق بشكل افتراضي ويُنشأ فهرس جديد أسبوعياً. يمكن للمسؤولين استخدام هذه المعلومات لمراقبة أداء النظام وتحديد أي مشاكل في المعالجة أو الاستقبال قبل أن تؤثر على العمليات الأمنية.

### فهارس حالة النظام wazuh-states-*

تشمل هذه المجموعة عدة أنماط فهرسة متخصصة لتخزين معلومات جرد الأنظمة والثغرات. فهرس wazuh-states-vulnerabilities-* يخزن معلومات عن الثغرات الأمنية المكتشفة في الأنظمة المراقبة مع تفاصيل مثل درجة الخطورة والحالة والبرمجيات المتأثرة.

أما فهارس الجرد فتشمل عدة أنماط متخصصة مثل wazuh-states-inventory-packages-* للبرمجيات المثبتة وwazuh-states-inventory-processes-* للعمليات الجارية وwazuh-states-inventory-ports-* للمنافذ المفتوحة. هذه الفهارس توفر رؤية شاملة لحالة كل نظام مراقب وتساعد في اكتشاف التغييرات غير المصرح بها والانحرافات عن خطوط الأساس المحددة.

![4](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/index_patterns_structure.svg)

## التفاعل مع مكونات النظام الأخرى

يمثل Wazuh Indexer نقطة التقاء حيوية في منظومة Wazuh للأمن السيبراني، حيث يتفاعل بشكل وثيق مع جميع المكونات الرئيسية الأخرى في النظام. هذا التفاعل المنظم يضمن تدفقاً سلساً للبيانات من نقطة الجمع على الأنظمة المراقبة وصولاً إلى العرض والتحليل على لوحة التحكم.

### التفاعل مع خادم Wazuh Manager

يبدأ التفاعل عندما يقوم خادم Wazuh بمعالجة الأحداث الواردة من الوكلاء وتطبيق قواعد الكشف عليها. عند تطابق حدث مع قاعدة معينة يتم إنشاء تنبيه أمني يُسجل في ملف alerts.json الموجود في المسار المحلي على الخادم. يحتفظ الخادم أيضاً بنسخة في ملف alerts.log بتنسيق نصي للأغراض التاريخية والاحتياطية.

يقوم الخادم بتنسيق الطوابع الزمنية وإضافة معلومات سياقية إضافية للتنبيهات قبل حفظها مما يسهل عملية الفهرسة اللاحقة. تشمل هذه المعلومات معرف الوكيل الذي أرسل الحدث ومستوى خطورة التنبيه ومعلومات القاعدة المطابقة والبيانات الخاصة بالحدث نفسه. هذا التنسيق الموحد يضمن أن جميع التنبيهات تتبع نفس البنية عند وصولها إلى Wazuh Indexer.

### التفاعل مع Filebeat

يعمل Filebeat كجسر ناقل للبيانات بين خادم Wazuh وبين Wazuh Indexer. يقوم Filebeat بمراقبة ملف alerts.json بشكل مستمر وعند ظهور تنبيهات جديدة يقرأها ويحولها إلى تنسيق مناسب للإرسال. يضمن Filebeat عدم إرسال أي تنبيه مرتين من خلال آلية تتبع ذكية تحفظ آخر موضع قراءة في الملف.

قبل إرسال البيانات يطبق Filebeat سلسلة من التحويلات المحددة في ملفات التكوين والقوالب. تشمل هذه التحويلات إضافة حقول إضافية مثل اسم النظام المصدر وإضافة علامات تصنيفية وتطبيق عوامل التصفية المحددة. يرسل Filebeat البيانات عبر بروتوكول HTTPS المشفر إلى واجهة برمجة Wazuh Indexer مع استخدام آلية المصادقة المكونة.

يدعم Filebeat أيضاً آلية إعادة المحاولة التلقائية في حالة فشل الاتصال بـ Wazuh Indexer مما يضمن عدم فقدان أي بيانات في حالات الأعطال المؤقتة. يحتفظ بالبيانات في ذاكرة مؤقتة ويعاود المحاولة وفق سياسة تراجع تدريجية حتى نجاح العملية.

### التفاعل مع لوحة التحكم Wazuh Dashboard

تعتمد لوحة التحكم Wazuh Dashboard بشكل كامل على Wazuh Indexer للحصول على البيانات التي تعرضها للمستخدمين. عندما يفتح المستخدم إحدى صفحات التحليل أو التقارير ترسل لوحة التحكم استعلامات معقدة إلى واجهة برمجة Wazuh Indexer لجلب البيانات المطلوبة. تستخدم هذه الاستعلامات لغة استعلام متقدمة تدعم التصفية والتجميع والفرز والتجميع الإحصائي.

تستخدم لوحة التحكم آلية تخزين مؤقت ذكية للاستعلامات المتكررة مما يقلل الحمل على Wazuh Indexer ويحسن زمن الاستجابة للمستخدم. كما تدعم التحديث التلقائي الدوري للبيانات المعروضة دون الحاجة لتحديث الصفحة يدوياً مما يوفر رؤية في الوقت الفعلي للوضع الأمني.

تتيح لوحة التحكم أيضاً للمستخدمين إنشاء لوحات معلومات مخصصة ومرئيات متنوعة تعتمد جميعها على البيانات المفهرسة في Wazuh Indexer. يمكن للمستخدمين تعريف استعلامات معقدة وحفظها لإعادة استخدامها لاحقاً أو مشاركتها مع أعضاء الفريق الآخرين.

![5](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/component_interaction.svg)

## ضبط الأداء وتحسين Wazuh Indexer

يتطلب تشغيل Wazuh Indexer في بيئات الإنتاج الكبيرة إجراء عدة تحسينات على الإعدادات الافتراضية لضمان أداء مثالي وموثوقية عالية. تشمل هذه التحسينات إدارة الذاكرة وتكوين الشاردز والنسخ المتماثلة بشكل صحيح.

### قفل الذاكرة Memory Locking

يُعتبر قفل الذاكرة من أهم إعدادات الأداء في Wazuh Indexer. عندما يبدأ نظام التشغيل في استخدام ملف المبادلة Swap للذاكرة قد يتأثر أداء Wazuh Indexer بشكل كبير. لذلك من الضروري منع نظام التشغيل من نقل ذاكرة Java Virtual Machine إلى القرص الصلب من خلال تفعيل قفل الذاكرة.

يتم تفعيل هذه الميزة بإضافة السطر bootstrap.memory_lock: true إلى ملف التكوين الرئيسي opensearch.yml. بالإضافة إلى ذلك يجب تكوين نظام التشغيل للسماح لعملية Wazuh Indexer بقفل كمية كافية من الذاكرة من خلال تعديل حدود الموارد في ملفات تكوين systemd.

بعد تطبيق هذه الإعدادات يجب التحقق من نجاح العملية عن طريق الاستعلام عن حالة العقدة والتأكد من أن قيمة mlockall مضبوطة على true. في حالة الفشل ستظهر رسالة خطأ في ملف سجلات Wazuh Indexer تشير إلى عدم القدرة على قفل ذاكرة JVM.

### تحديد حجم ذاكرة JVM Heap

يجب تحديد حجم مناسب لذاكرة JVM Heap بناءً على كمية ذاكرة الوصول العشوائي المتاحة في النظام. القاعدة العامة هي تخصيص نصف ذاكرة النظام لـ JVM Heap مع عدم تجاوز حد أقصى قدره 32 جيجابايت. يجب أن تكون القيمتان Xms للحد الأدنى و Xmx للحد الأقصى متطابقتين لمنع إعادة تخصيص الذاكرة أثناء التشغيل مما قد يؤثر على الأداء.

على سبيل المثال في نظام بذاكرة 8 جيجابايت يُنصح بتخصيص 4 جيجابايت لـ JVM Heap من خلال إضافة الأسطر Xms4g- و Xmx4g- إلى ملف jvm.options. النصف المتبقي من الذاكرة يُستخدم من قبل نظام التشغيل والعمليات الأخرى ولعمليات التخزين المؤقت على مستوى نظام الملفات مما يحسن أداء القراءة والكتابة.

### تحسين عدد الشاردز والنسخ المتماثلة

يُعتبر تحديد العدد الصحيح من الشاردز والنسخ المتماثلة من أهم قرارات التصميم في Wazuh Indexer. القاعدة العامة هي أن يكون عدد الشاردز الأساسية مساوياً لعدد العقد في المجموعة مما يضمن توزيعاً متوازناً للحمل ويتيح الاستفادة القصوى من موارد جميع العقد.

بالنسبة للنسخ المتماثلة يعتمد العدد المثالي على مستوى التوافرية المطلوب ومساحة التخزين المتاحة. في مجموعة مكونة من ثلاث عقد يوفر استخدام نسخة متماثلة واحدة توازناً جيداً بين التوافرية ومتطلبات التخزين حيث يمكن للنظام الاستمرار في العمل حتى لو تعطلت عقدة واحدة. استخدام نسختين متماثلتين يوفر حماية أكبر لكنه يضاعف متطلبات التخزين ثلاث مرات.

يجب الانتباه إلى أنه لا يمكن تغيير عدد الشاردز بعد إنشاء الفهرس دون إجراء عملية إعادة فهرسة Re-indexing. لذلك من المهم التخطيط الجيد لعدد الشاردز قبل بدء استخدام النظام في بيئة الإنتاج. في المقابل يمكن تعديل عدد النسخ المتماثلة في أي وقت دون الحاجة لإعادة فهرسة البيانات.

## عملية إعادة الفهرسة Re-indexing

تُستخدم عملية إعادة الفهرسة عندما تحدث تغييرات على مخطط البيانات أو عند الحاجة لنسخ بيانات من فهرس قديم إلى فهرس جديد. قد تكون هذه التغييرات ضرورية عند تحديث النظام أو عند تغيير تكوين الشاردز أو عند تطبيق قوالب جديدة تتطلب تنسيقات مختلفة للبيانات.

يمكن تنفيذ عملية إعادة الفهرسة من خلال واجهة Dev Tools في لوحة التحكم Wazuh Dashboard أو من خلال سطر الأوامر باستخدام cURL. تستخدم العملية واجهة برمجية خاصة تسمى _reindex التي تقوم بنسخ جميع المستندات من الفهرس المصدر إلى الفهرس الوجهة مع تطبيق أي تحويلات ضرورية.

خلال عملية إعادة الفهرسة يتم نسخ البيانات على دفعات بشكل تسلسلي مما يقلل من التأثير على أداء النظام. يعرض الناتج معلومات مفصلة عن العملية تشمل عدد المستندات المنسوخة والوقت المستغرق وأي تعارضات في الإصدارات وأي أخطاء حدثت أثناء العملية. يمكن مراقبة تقدم العملية للفهارس الكبيرة من خلال استعلامات منفصلة تستخدم واجهة _tasks البرمجية.

بعد إتمام عملية إعادة الفهرسة بنجاح يمكن حذف الفهرس القديم إذا لم تعد هناك حاجة له أو الاحتفاظ به كنسخة احتياطية لفترة محددة. من المهم التأكد من أن لوحة التحكم والتطبيقات الأخرى تم تكوينها لاستخدام نمط الفهرس الجديد قبل حذف الفهرس القديم لتجنب فقدان الوصول إلى البيانات.

![6](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/performance_tuning.svg)

## الأمان والحماية في Wazuh Indexer

يشكل الأمان عنصراً أساسياً في تصميم Wazuh Indexer خاصة أنه يتعامل مع بيانات أمنية حساسة تتطلب حماية قوية من الوصول غير المصرح به والتلاعب. يعتمد النظام على عدة طبقات أمنية متكاملة لضمان سرية البيانات وسلامتها وتوافريتها.

### التشفير وإدارة الشهادات

يفرض Wazuh Indexer استخدام بروتوكول HTTPS لجميع الاتصالات الواردة والصادرة مع دعم إصدارات TLS 1.2 أو أحدث. تُخزن الشهادات الرقمية في المسار `/etc/wazuh-indexer/certs/` وتشمل شهادة الخادم والمفتاح الخاص وشهادات سلطة الإصدار. يتطلب النظام أن تكون جميع الشهادات صالحة وموثوقة لضمان إنشاء اتصالات آمنة.

يدعم النظام أيضاً المصادقة المتبادلة بين العميل والخادم من خلال شهادات العميل Client Certificates مما يوفر طبقة أمان إضافية للبيئات عالية الحساسية. يمكن تكوين هذه الميزة من خلال ملف opensearch.yml مع تحديد المسارات للشهادات المطلوبة وسياسات التحقق منها.

### إدارة الهوية والصلاحيات

يوفر Wazuh Indexer نظاماً متقدماً لإدارة المستخدمين والأدوار والصلاحيات يعتمد على نموذج التحكم بالوصول القائم على الأدوار RBAC. يمكن تعريف أدوار مخصصة لكل مجموعة من المستخدمين وتحديد الصلاحيات بدقة على مستوى الفهرس أو المستند أو الحقل.

يتم تخزين بيانات المصادقة بشكل آمن مع تشفير كلمات المرور باستخدام خوارزميات تجزئة قوية مثل bcrypt. يدعم النظام أيضاً التكامل مع مزودي الهوية الخارجيين من خلال بروتوكولات مثل LDAP وSAML وOpenID Connect مما يسهل دمجه في البنى التحتية الأمنية القائمة للمؤسسات.

### حماية البيانات أثناء النقل والتخزين

تُحمى جميع البيانات المنقولة بين مكونات النظام المختلفة من خلال التشفير باستخدام TLS. هذا يشمل الاتصالات بين الوكلاء وخادم Wazuh وبين Filebeat وWazuh Indexer وبين لوحة التحكم وWazuh Indexer. كما يدعم النظام تشفير الاتصالات الداخلية بين عقد المجموعة لحماية البيانات المتبادلة أثناء عمليات التماثل والموازنة.

أما بالنسبة للبيانات المخزنة فيوفر Wazuh Indexer إمكانية تفعيل التشفير على مستوى القرص كميزة اختيارية. يمكن استخدام تقنيات تشفير القرص على مستوى نظام التشغيل مثل LUKS في لينكس أو BitLocker في ويندوز لحماية البيانات المخزنة في المسار `/var/lib/wazuh-indexer/` من الوصول الفيزيائي غير المصرح به.

### المراقبة والتدقيق الأمني

يحتفظ Wazuh Indexer بسجلات تفصيلية لجميع العمليات والأحداث الأمنية في ملف `/var/log/wazuh-indexer/wazuh-indexer.log`. تشمل هذه السجلات محاولات المصادقة الناجحة والفاشلة والعمليات المنفذة على الفهارس والتغييرات في الإعدادات والأخطاء والتحذيرات المختلفة. يمكن تكوين مستوى التفصيل في السجلات حسب الحاجة مع مراعاة التوازن بين الأمان والأداء.

يوصى بمراقبة هذه السجلات بشكل دوري ودمجها مع أنظمة إدارة الأحداث الأمنية SIEM للكشف المبكر عن أي أنشطة مشبوهة أو محاولات اختراق. يمكن أيضاً تفعيل ميزات التنبيه التلقائي عند حدوث أحداث أمنية حرجة مثل تكرار محاولات المصادقة الفاشلة أو محاولات الوصول إلى موارد غير مصرح بها.

## الصيانة والإدارة اليومية

تتطلب إدارة Wazuh Indexer في بيئات الإنتاج اتباع ممارسات صيانة منتظمة لضمان استمرارية العمل والأداء الأمثل. تشمل هذه الممارسات مراقبة صحة النظام وإدارة مساحة التخزين والنسخ الاحتياطي والاستعادة.

### مراقبة صحة النظام والأداء

يوفر Wazuh Indexer عدة واجهات برمجية لمراقبة حالة المجموعة وأدائها. يمكن استخدام واجهة `/_cluster/health` للحصول على نظرة عامة سريعة عن حالة المجموعة التي قد تكون خضراء أي جميع الشاردز نشطة أو صفراء أي بعض النسخ المتماثلة غير متوفرة أو حمراء أي بعض الشاردز الأساسية غير متوفرة.

توفر واجهة `/_nodes/stats` معلومات مفصلة عن استخدام الموارد في كل عقدة تشمل استخدام الذاكرة والمعالج ومساحة القرص وإحصائيات الشبكة. يجب مراقبة هذه المؤشرات بانتظام وإعداد تنبيهات عند تجاوز عتبات محددة مثل استخدام القرص بنسبة تزيد عن ثمانين بالمائة أو استخدام ذاكرة JVM بنسبة تقترب من الحد الأقصى.

### إدارة دورة حياة الفهارس

مع مرور الوقت تتراكم كميات كبيرة من البيانات في Wazuh Indexer مما يستهلك مساحة تخزين كبيرة ويؤثر على الأداء. لذلك من الضروري تطبيق سياسات لإدارة دورة حياة الفهارس Index Lifecycle Management تتضمن حذف أو أرشفة الفهارس القديمة بشكل تلقائي.

يمكن تحديد فترات احتفاظ مختلفة لكل نوع من الفهارس حسب متطلبات الامتثال والاستخدام. على سبيل المثال قد يتم الاحتفاظ بفهارس التنبيهات لمدة تسعين يوماً بينما يتم الاحتفاظ بفهارس الجرد لمدة ثلاثين يوماً فقط. يمكن تنفيذ هذه السياسات من خلال مهام مجدولة تستخدم واجهة برمجية لحذف الفهارس بناءً على تاريخ إنشائها.

### النسخ الاحتياطي والاستعادة

يعتبر النسخ الاحتياطي المنتظم للبيانات أمراً بالغ الأهمية لحماية البيانات من الفقدان نتيجة الأعطال أو الأخطاء البشرية أو الهجمات الإلكترونية. يدعم Wazuh Indexer آلية اللقطات Snapshots التي تسمح بإنشاء نسخ احتياطية متزايدة من الفهارس وتخزينها في مستودعات خارجية.

يجب تكوين مستودع للقطات بشكل مسبق والذي يمكن أن يكون نظام ملفات مشترك أو خدمة تخزين سحابية مثل Amazon S3. بعد ذلك يمكن جدولة عمليات إنشاء اللقطات بشكل دوري يومياً أو أسبوعياً حسب معدل تغير البيانات وأهميتها. تسمح آلية اللقطات باستعادة بيانات محددة أو النظام بأكمله إلى حالة سابقة في حالة الحاجة.

![7](https://raw.githubusercontent.com/Rasheed1506993/wazuh_lab/main/media/security_maintenance.svg)

## الخلاصة والنقاط الرئيسية

يمثل Wazuh Indexer مكوناً محورياً في منظومة Wazuh للأمن السيبراني حيث يوفر البنية التحتية الأساسية لتخزين وفهرسة واسترجاع البيانات الأمنية بكفاءة عالية. تعتمد قدرات النظام على تقنيات OpenSearch المتقدمة التي توفر محرك بحث نصي كامل مع قدرات تحليلية متطورة تدعم عمليات المراقبة الأمنية في الوقت الفعلي.

تتميز البنية المعمارية للنظام بالمرونة والقابلية للتوسع من خلال آلية الشاردز والنسخ المتماثلة التي تضمن توزيعاً متوازناً للبيانات عبر عقد المجموعة وتوفر مستويات عالية من التوافرية وقدرات المعالجة الموازية. يتيح هذا التصميم للنظام التعامل مع أحجام كبيرة من البيانات الأمنية دون التأثير على الأداء أو الاستقرار.

يتفاعل Wazuh Indexer بشكل وثيق مع بقية مكونات المنظومة حيث يستقبل البيانات المُحللة من خادم Wazuh عبر Filebeat ويوفرها للاستعلام والتحليل عبر لوحة التحكم Wazuh Dashboard. يعتمد هذا التفاعل على بروتوكولات أمنية معيارية تشمل HTTPS وTLS والمصادقة القوية مما يضمن حماية البيانات أثناء النقل والتخزين.

توفر أنماط الفهارس المتعددة في النظام تنظيماً شاملاً للبيانات الأمنية المختلفة بدءاً من التنبيهات والأحداث وصولاً إلى معلومات الجرد والثغرات. يسمح هذا التنظيم بإدارة فعالة لدورة حياة البيانات وتطبيق سياسات احتفاظ مخصصة لكل نوع من البيانات حسب متطلبات الامتثال والاستخدام.

يتطلب الحفاظ على أداء مثالي للنظام في بيئات الإنتاج تطبيق ممارسات ضبط وتحسين متخصصة تشمل إدارة الذاكرة بشكل صحيح وتكوين أعداد مناسبة من الشاردز والنسخ المتماثلة ومراقبة دورية لصحة النظام وموارده. كما يُعتبر تطبيق استراتيجيات شاملة للنسخ الاحتياطي والاستعادة أمراً بالغ الأهمية لضمان استمرارية العمل وحماية البيانات من الفقدان.

في النهاية يُعد فهم آلية العمل الداخلية لـ Wazuh Indexer والتقنيات المستخدمة فيه أمراً أساسياً لمسؤولي النظم والمختصين في الأمن السيبراني الذين يعتمدون على Wazuh في عمليات المراقبة الأمنية. هذا الفهم العميق يمكّنهم من استغلال القدرات الكاملة للنظام وتحسين أدائه وضمان استقراره في بيئات الإنتاج المختلفة.

</div>