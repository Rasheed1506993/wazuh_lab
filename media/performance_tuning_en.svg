<svg viewBox="0 0 900 900" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#2C3E50">
    Wazuh Indexer Performance Tuning Guide
  </text>
  
  <!-- Memory Management Section -->
  <rect x="50" y="70" width="800" height="180" fill="#3498DB" fill-opacity="0.1" stroke="#3498DB" stroke-width="3" rx="10"/>
  <text x="450" y="95" text-anchor="middle" font-size="18" font-weight="bold" fill="#2980B9">
    Memory Management
  </text>
  
  <!-- Memory Locking -->
  <rect x="80" y="115" width="370" height="120" fill="#2980B9" fill-opacity="0.2" stroke="#2980B9" stroke-width="2" rx="8"/>
  <text x="265" y="138" text-anchor="middle" font-size="14" font-weight="bold" fill="#1F618D">
    Memory Locking
  </text>
  <text x="100" y="160" font-size="11" fill="#2C3E50">
    Config File: /etc/wazuh-indexer/opensearch.yml
  </text>
  <text x="100" y="178" font-size="11" fill="#2C3E50">
    Setting: bootstrap.memory_lock: true
  </text>
  <text x="100" y="196" font-size="11" fill="#2C3E50">
    systemd: LimitMEMLOCK=infinity
  </text>
  <text x="100" y="214" font-size="11" fill="#2C3E50">
    Verify: curl ".../_nodes?filter_path=**.mlockall"
  </text>
  
  <!-- JVM Heap -->
  <rect x="470" y="115" width="360" height="120" fill="#2980B9" fill-opacity="0.2" stroke="#2980B9" stroke-width="2" rx="8"/>
  <text x="650" y="138" text-anchor="middle" font-size="14" font-weight="bold" fill="#1F618D">
    JVM Heap Size
  </text>
  <text x="490" y="160" font-size="11" fill="#2C3E50">
    Config File: /etc/wazuh-indexer/jvm.options
  </text>
  <text x="490" y="178" font-size="11" fill="#2C3E50">
    Rule: 50% of system memory (max 32GB)
  </text>
  <text x="490" y="196" font-size="11" fill="#2C3E50">
    Example for 8GB system: -Xms4g and -Xmx4g
  </text>
  <text x="490" y="214" font-size="11" fill="#2C3E50">
    Important: Xms = Xmx to avoid reallocation
  </text>
  
  <!-- Shards and Replicas Section -->
  <rect x="50" y="280" width="800" height="220" fill="#9B59B6" fill-opacity="0.1" stroke="#9B59B6" stroke-width="3" rx="10"/>
  <text x="450" y="305" text-anchor="middle" font-size="18" font-weight="bold" fill="#8E44AD">
    Shards and Replicas
  </text>
  
  <!-- Shards Configuration -->
  <rect x="80" y="325" width="740" height="80" fill="#8E44AD" fill-opacity="0.15" stroke="#8E44AD" stroke-width="2" rx="8"/>
  <text x="450" y="348" text-anchor="middle" font-size="14" font-weight="bold" fill="#6C3483">
    Shards Configuration
  </text>
  <text x="100" y="370" font-size="11" fill="#2C3E50">
    • General rule: Number of shards = number of nodes in cluster
  </text>
  <text x="100" y="388" font-size="11" fill="#2C3E50">
    • Cannot change count after creation without reindexing
  </text>
  
  <!-- Replicas Configuration -->
  <rect x="80" y="415" width="740" height="70" fill="#8E44AD" fill-opacity="0.15" stroke="#8E44AD" stroke-width="2" rx="8"/>
  <text x="450" y="438" text-anchor="middle" font-size="14" font-weight="bold" fill="#6C3483">
    Replicas Configuration
  </text>
  <text x="100" y="460" font-size="11" fill="#2C3E50">
    • 3-node cluster without replicas: Data loss risk    • 3-node cluster with one replica: Good balance (Recommended)
  </text>
  <text x="100" y="478" font-size="11" fill="#2C3E50">
    • 3-node cluster with two replicas: High availability but 3x storage    • Can change count anytime
  </text>
  
  <!-- Re-indexing Section -->
  <rect x="50" y="530" width="800" height="180" fill="#E74C3C" fill-opacity="0.1" stroke="#E74C3C" stroke-width="3" rx="10"/>
  <text x="450" y="555" text-anchor="middle" font-size="18" font-weight="bold" fill="#C0392B">
    Re-indexing
  </text>
  
  <rect x="80" y="575" width="370" height="120" fill="#C0392B" fill-opacity="0.15" stroke="#C0392B" stroke-width="2" rx="8"/>
  <text x="265" y="598" text-anchor="middle" font-size="14" font-weight="bold" fill="#922B21">
    When do we need reindexing?
  </text>
  <text x="100" y="620" font-size="11" fill="#2C3E50">
    • Changing data schema
  </text>
  <text x="100" y="638" font-size="11" fill="#2C3E50">
    • Changing number of shards
  </text>
  <text x="100" y="656" font-size="11" fill="#2C3E50">
    • Applying new templates
  </text>
  <text x="100" y="674" font-size="11" fill="#2C3E50">
    • Copying data between indices
  </text>
  
  <rect x="470" y="575" width="360" height="120" fill="#C0392B" fill-opacity="0.15" stroke="#C0392B" stroke-width="2" rx="8"/>
  <text x="650" y="598" text-anchor="middle" font-size="14" font-weight="bold" fill="#922B21">
    Reindexing Method
  </text>
  <text x="490" y="620" font-size="11" fill="#2C3E50">
    POST /_reindex
  </text>
  <text x="490" y="638" font-size="11" fill="#2C3E50">
    {"source": {"index": "old-index"},
  </text>
  <text x="490" y="656" font-size="11" fill="#2C3E50">
     "dest": {"index": "new-index"}}
  </text>
  <text x="490" y="674" font-size="11" fill="#2C3E50">
    Copying done in batches to minimize impact
  </text>
  
  <!-- Best Practices Section -->
  <rect x="50" y="740" width="800" height="140" fill="#16A085" fill-opacity="0.1" stroke="#16A085" stroke-width="3" rx="10"/>
  <text x="450" y="765" text-anchor="middle" font-size="18" font-weight="bold" fill="#138D75">
    Best Practices
  </text>
  
  <text x="80" y="795" font-size="12" fill="#2C3E50">
    1. Monitor memory and disk usage periodically via /_nodes/stats
  </text>
  <text x="80" y="815" font-size="12" fill="#2C3E50">
    2. Keep 15-20% of disk space free for optimal performance
  </text>
  <text x="80" y="835" font-size="12" fill="#2C3E50">
    3. Implement Index Lifecycle Management (ILM) strategy to automatically delete old data
  </text>
  <text x="80" y="855" font-size="12" fill="#2C3E50">
    4. Test performance settings in development environment before applying to production
  </text>
</svg>